<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Digital Literacy Helper - Fake News Detection</title>

  <!-- Fonts & Icons -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

  <!-- ================= STYLES ================= -->
  <style>
    :root {
      --primary-accent: #FF6E00;
      --background-start: #FFFFFF;
      --background-end: #FFEEDD;
      --component-bg-translucent: rgba(255,255,255,0.7);
      --text-dark: #333;
      --shadow-light: rgba(0,0,0,0.08);
      --shadow-dark: rgba(255,110,0,0.4);
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Poppins', sans-serif;
      min-height: 100vh;
      background: linear-gradient(135deg,var(--background-start),var(--background-end));
      padding: 40px 20px;
      color: var(--text-dark);
    }

    .container { max-width: 1200px; margin: auto; }

    header { text-align: center; margin-bottom: 30px; }
    h1 { color: var(--primary-accent); font-size: 2.5rem; font-weight: 800; }
    .subtitle { color: #666; }

    .main-card {
      background: var(--component-bg-translucent);
      backdrop-filter: blur(10px);
      border-radius: 24px;
      padding: 2.5rem;
      box-shadow: 0 10px 30px var(--shadow-light);
    }

    .content-split {
      display: flex;
      gap: 30px;
    }

    .input-panel, .result-panel {
      flex: 1;
      background: white;
      padding: 25px;
      border-radius: 16px;
    }

    .result-panel {
      min-height: 300px;
      text-align: center;
      border: 1px dashed #ddd;
    }

    .input-toggle {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      background: rgba(255,110,0,0.1);
      padding: 6px;
      border-radius: 12px;
    }

    .toggle-btn {
      flex: 1;
      border: none;
      padding: 10px;
      cursor: pointer;
      border-radius: 8px;
      background: transparent;
    }

    .toggle-btn.active {
      background: var(--primary-accent);
      color: white;
    }

    .input-mode { display: none; }
    .input-mode.active { display: block; }

    textarea {
      width: 100%;
      min-height: 150px;
      padding: 12px;
      border-radius: 12px;
      border: 2px solid rgba(255,110,0,0.2);
    }

    .upload-area {
      border: 2px dashed rgba(255,110,0,0.4);
      padding: 30px;
      border-radius: 12px;
      cursor: pointer;
    }

    .check-button {
      width: 100%;
      margin-top: 20px;
      padding: 16px;
      background: var(--primary-accent);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 1.2rem;
      cursor: pointer;
    }

    .loader { display: none; }
    .loader.active { display: block; }

    .spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(255,110,0,0.2);
      border-top: 4px solid var(--primary-accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: auto;
    }

    @keyframes spin {
      100% { transform: rotate(360deg); }
    }

    .result-card {
      padding: 20px;
      border-left: 6px solid;
      border-radius: 12px;
      text-align: left;
    }

    .result-Likely_Fake { background: #fee2e2; border-color: #dc2626; }
    .result-Likely_Real { background: #dcfce7; border-color: #16a34a; }
    .result-Unverified___Needs_Caution { background: #fef3c7; border-color: #ca8a04; }

    @media(max-width:900px){
      .content-split{flex-direction:column;}
    }
  </style>
</head>

<body>
<div class="container">

  <header>
    <h1>DIGITAL LITERACY HELPER</h1>
    <p class="subtitle">Verify news, detect schemes, stay safe online</p>
  </header>

  <!-- ================= FORM ================= -->
  <form action="{{ url_for('analyze_fraud') }}" method="post" enctype="multipart/form-data" id="analysisForm">
    <div class="main-card">
      <div class="content-split">

        <!-- INPUT -->
        <div class="input-panel">
          <h2>Fake News / Scheme Detection</h2>

          <div class="input-toggle" id="inputToggle">
            <button type="button" class="toggle-btn active" data-mode="text">üìù Text</button>
            <button type="button" class="toggle-btn" data-mode="image">üñºÔ∏è File</button>
          </div>

          <div id="textMode" class="input-mode active">
            <textarea id="textInput" name="textInput" placeholder="Paste suspicious news or message..."></textarea>
          </div>

          <div id="imageMode" class="input-mode">
            <div class="upload-area" id="uploadArea">
              <i class="fas fa-cloud-upload-alt fa-2x"></i>
              <p>Click or Drop file</p>
              <p id="fileName"></p>
            </div>
            <input type="file" id="imageUpload" name="imageUpload" hidden>
          </div>

          <button class="check-button" id="checkButton">CHECK</button>
        </div>

        <!-- RESULT -->
        <div class="result-panel">
          <div class="loader" id="loader">
            <div class="spinner"></div>
            <p>Analyzing...</p>
          </div>
          <div id="resultsOutput">
            <p style="color:#999">Result will appear here</p>
          </div>
        </div>

      </div>
    </div>
  </form>

</div>

<!-- ================= SCRIPT ================= -->
<script>
const FLASK_INITIAL_DATA_STRING = '{{ initial_data | default({}) | tojson | safe }}';

document.addEventListener("DOMContentLoaded", () => {

  const toggleBtns = document.querySelectorAll(".toggle-btn");
  const textMode = document.getElementById("textMode");
  const imageMode = document.getElementById("imageMode");
  const uploadArea = document.getElementById("uploadArea");
  const imageUpload = document.getElementById("imageUpload");
  const fileName = document.getElementById("fileName");
  const loader = document.getElementById("loader");
  const resultsOutput = document.getElementById("resultsOutput");
  const form = document.getElementById("analysisForm");

  toggleBtns.forEach(btn => {
    btn.addEventListener("click", () => {
      toggleBtns.forEach(b => b.classList.remove("active"));
      btn.classList.add("active");

      if(btn.dataset.mode === "text"){
        textMode.classList.add("active");
        imageMode.classList.remove("active");
      } else {
        imageMode.classList.add("active");
        textMode.classList.remove("active");
      }
    });
  });

  uploadArea.onclick = () => imageUpload.click();
  imageUpload.onchange = () => fileName.textContent = imageUpload.files[0]?.name || "";

  form.addEventListener("submit", () => {
    loader.classList.add("active");
    resultsOutput.innerHTML = "";
  });

  function renderResult(data){
    if(!data.result_class) return;

    resultsOutput.innerHTML = `
      <div class="result-card result-${data.result_class}">
        <h3>${data.result_class.replaceAll("_"," ")}</h3>
        <p>${data.result_text || ""}</p>
        ${data.result_details ? `<p><b>Details:</b> ${data.result_details}</p>` : ""}
      </div>`;
    loader.classList.remove("active");
  }

  try {
    const initialData = JSON.parse(FLASK_INITIAL_DATA_STRING || "{}");
    renderResult(initialData);
  } catch(e){ console.error(e); }
});
</script>

</body>
</html>
